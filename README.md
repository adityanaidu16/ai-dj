# AI DJ - Intelligent Music Discovery Assistant

An AI-powered DJ assistant built on Cloudflare's platform that leverages **Llama 3.1** for intelligent music recommendations and creates personalized Spotify playlists based on natural language conversations.

## ğŸ¯ Assignment Requirements Fulfilled

This project demonstrates all required components for the Cloudflare AI application assignment:

âœ… **LLM Integration** - Uses **Llama 3.1 (70B)** on Workers AI for natural language understanding
âœ… **Workflow/Coordination** - Implements **Durable Objects** for state management and coordination
âœ… **User Input** - Interactive **chat interface** built with Cloudflare Pages
âœ… **Memory/State** - Persistent user sessions and preferences using **Durable Objects**

## ğŸš€ Key Features

### Intelligent Music Discovery
- **Dynamic Question Generation**: The AI asks contextually relevant follow-up questions to understand user preferences
- **Smart Search Strategies**: Creates sophisticated Spotify search queries based on mood, energy, and context
- **Song Analysis**: Detects when users reference specific songs and adapts recommendations accordingly
- **Anti-Repetition Logic**: Prevents asking similar questions and ensures varied recommendations

### Technical Innovation
- **No Hardcoded Logic**: All recommendations are dynamically generated by the LLM
- **Adaptive Learning**: Tracks user preferences and listening history across sessions
- **Efficient Caching**: Uses KV storage for Spotify token management
- **Real-time Processing**: Instant responses with streaming AI capabilities

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat Interface â”‚â”€â”€â”€â”€â–¶â”‚  Worker (Hono)   â”‚â”€â”€â”€â”€â–¶â”‚   Llama 3.1     â”‚
â”‚   (Pages/HTML)  â”‚     â”‚   API Routes     â”‚     â”‚  (Workers AI)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚                          â”‚
                               â–¼                          â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Durable Objects  â”‚     â”‚   Spotify API   â”‚
                    â”‚  (User Sessions)  â”‚     â”‚  (Music Data)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Components

1. **Frontend (Cloudflare Pages)**
   - Single-page chat interface with real-time updates
   - Interactive question/answer flow with multiple choice options
   - Visual track recommendations with album art

2. **Backend (Cloudflare Workers)**
   - RESTful API built with Hono framework
   - Session management and request routing
   - Spotify API integration for music search

3. **AI Layer (Workers AI)**
   - Llama 3.1 70B model for natural language processing
   - Dynamic prompt engineering based on context
   - Intelligent search strategy generation

4. **State Management (Durable Objects)**
   - `UserSession`: Persistent user preferences and history
   - `DJState`: Global statistics and active user tracking
   - Real-time session updates

## ğŸ”§ Technical Stack

- **Runtime**: Cloudflare Workers (Edge Computing)
- **AI Model**: Llama 3.1 70B (via Workers AI)
- **Framework**: Hono (Lightweight web framework)
- **State**: Durable Objects + KV Storage
- **Language**: TypeScript
- **Build Tool**: Wrangler CLI
- **External API**: Spotify Web API

## ğŸ“ Setup Instructions

### Prerequisites
- Node.js 20+
- Cloudflare account
- Spotify Developer account

### Installation

1. Clone the repository:
```bash
git clone https://github.com/[your-username]/ai-dj.git
cd ai-dj
```

2. Install dependencies:
```bash
npm install
```

3. Configure Spotify credentials in `wrangler.toml`:
```toml
[vars]
SPOTIFY_CLIENT_ID = "your_client_id"
SPOTIFY_CLIENT_SECRET = "your_client_secret"
```

4. Create KV namespaces:
```bash
npx wrangler kv:namespace create "CACHE"
npx wrangler kv:namespace create "PLAYLISTS"
```

5. Run locally:
```bash
npm run dev
```

6. Deploy to Cloudflare:
```bash
npm run deploy
```

## ğŸ’¡ How It Works

### Conversation Flow

1. **Initial Request**: User asks for music (e.g., "songs like Currents by Drake")
2. **Context Analysis**: AI analyzes the request and referenced songs
3. **Dynamic Questions**: If needed, AI asks 2-3 contextual follow-up questions
4. **Search Generation**: AI creates multiple search strategies based on the context
5. **Spotify Integration**: Searches playlists and tracks using generated queries
6. **Smart Filtering**: Ranks and filters results by popularity and relevance
7. **Presentation**: Returns curated recommendations with visual elements

### Example Interactions

```
User: "Give me songs like Currents by Drake"

AI: Detects this is a mellow, introspective track and searches for:
- "introspective hip hop"
- "melodic rap"
- "Toronto sound"
- "late night R&B"

Result: 20 curated tracks matching the vibe
```

## ğŸ¨ Design Decisions

### Why Llama 3.1?
- Superior context understanding compared to older models
- Better at following complex instructions
- More nuanced understanding of music genres and moods

### Why Durable Objects?
- Perfect for maintaining user session state
- Enables real-time coordination without external databases
- Scalable and globally distributed

### Why Dynamic Prompting?
- No hardcoded questions or logic
- Adapts to any music preference or context
- Continuously improvable through prompt engineering

## ğŸ”’ Security & Performance

- **Token Security**: Spotify credentials stored as environment variables
- **Rate Limiting**: Intelligent caching to minimize API calls
- **Edge Computing**: Responses served from nearest Cloudflare location
- **Efficient Prompts**: Optimized token usage with structured outputs

## ğŸ“Š API Endpoints

- `GET /` - Chat interface
- `POST /api/chat` - Process user messages
- `POST /api/preferences` - Update user preferences
- `GET /api/stats` - Global usage statistics
- `GET /api/session/:id` - Retrieve session data
- `GET /api/health` - Health check

## ğŸš¦ Future Enhancements

- [ ] Voice input support using Web Speech API
- [ ] Playlist creation in user's Spotify account
- [ ] Multi-language support
- [ ] Collaborative playlists
- [ ] Music visualization

## ğŸ“„ License

ISC License

## ğŸ¤ Acknowledgments

Built for Cloudflare's AI Application Assignment using:
- Cloudflare Workers AI
- Cloudflare Durable Objects
- Spotify Web API
- Hono Framework

---

**Demo**: [Deploy and visit http://localhost:8787 after local setup]
**Documentation**: [Cloudflare Workers AI Docs](https://developers.cloudflare.com/workers-ai/)